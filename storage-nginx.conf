# Конфигурационный файл для Nginx на сервере-хранилище

server {
    listen 80;
    listen [::]:80;

    # Замените на IP вашего хранилища или оставьте "_" для любого хоста
    server_name _; 

    # Устанавливаем корневую директорию, где Nginx будет искать файлы.
    root /var/www/html;

    location /downloads/ {
        # Путь к файлам на диске. 
        # Убедитесь, что он совпадает с тем, что вы укажете в STORAGE_PATH в .env файле бота
        alias /var/www/html/downloads/;

        # Включаем отображение списка файлов в директории.
        # Удобно для отладки. Можете закомментировать (поставив # в начале), если не нужно.
        autoindex on;

        # Позволяет Nginx корректно определять Content-Type файлов
        # Это важно, чтобы Telegram правильно распознавал тип контента.
        include /etc/nginx/mime.types;
    }

    access_log /var/log/nginx/storage.access.log;
    error_log /var/log/nginx/storage.error.log;
}

# --- Инструкция по установке ---
# 
# 1. Установите Nginx на сервере-хранилище, если его нет:
#    sudo apt-get update
#    sudo apt-get install nginx
#
# 2. Создайте директорию для файлов и установите права:
#    sudo mkdir -p /var/www/html/downloads
#    sudo chown www-data:www-data /var/www/html/downloads
#    (Предполагается, что Nginx работает от пользователя www-data. Если у вас другой, измените пользователя).
#
# 3. Скопируйте этот файл на сервер-хранилище по пути:
#    /etc/nginx/sites-available/storage.conf
#
# 4. Активируйте конфигурацию (создайте символическую ссылку):
#    sudo ln -s /etc/nginx/sites-available/storage.conf /etc/nginx/sites-enabled/
#    # Возможно, потребуется удалить стандартный сайт Nginx, если он мешает:
#    # sudo rm /etc/nginx/sites-enabled/default
#
# 5. Проверьте синтаксис конфигурации:
#    sudo nginx -t
#    # Если видите "syntax is ok" и "test is successful", все хорошо.
#
# 6. Перезапустите Nginx, чтобы применить изменения:
#    sudo systemctl restart nginx
#
# 7. Убедитесь, что ваш .env файл для бота настроен соответственно:
#    STORAGE_PATH="/var/www/html/downloads"
#    STORAGE_PUBLIC_URL_PREFIX="http://<IP-адрес_хранилища>/downloads/"
#    (Не забудьте слэш в конце URL)

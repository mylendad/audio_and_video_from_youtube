# План по реализации отправки файлов >50МБ

## 1. Контекст проблемы

После долгой отладки было установлено, что **Telegram Bot API не позволяет отправлять файлы по URL, если их размер превышает 50 МБ**. Это является фундаментальным ограничением API.

Текущая архитектура (загрузка на удаленный SFTP-сервер и передача Telegram URL для скачивания) успешно работает, но только для файлов размером до 50 МБ. Для файлов большего размера Telegram всегда будет возвращать ошибку `Bad Request: wrong type of the web page content`, так как он отклоняет файл из-за его размера.

## 2. Единственное решение

Единственный способ отправить файл размером более 50 МБ через Bot API — это **прямая загрузка файла** с сервера бота на серверы Telegram (с использованием `multipart/form-data`). В библиотеке `aiogram` это реализуется через объект `types.FSInputFile`.

## 3. Предлагаемый новый воркфлоу

Чтобы использовать уже настроенную инфраструктуру с удаленным хранилищем и обойти ограничение API, предлагается следующий алгоритм для обработки файлов размером **более 50 МБ**:

1.  **Скачивание с YouTube:** Бот, как и раньше, скачивает видео с YouTube на свой временный локальный диск.

2.  **Загрузка на удаленное хранилище:** Бот загружает скачанный файл на ваш SFTP-сервер-хранилище. Этот шаг сохраняется, чтобы у вас была копия файла и работала текущая логика.

3.  **(Новый шаг) Скачивание файла ботом с хранилища:** Чтобы отправить файл напрямую, боту нужно иметь его локально. Поэтому он будет **сам скачивать этот же файл со своего же удаленного хранилища** обратно на свой временный диск. *Примечание: это может показаться неэффективным, но это необходимое связующее звено.*

4.  **Прямая отправка в Telegram:** Бот отправляет локальный файл пользователю с помощью `types.FSInputFile`, который инициирует прямую загрузку на серверы Telegram.

5.  **Очистка:** Бот удаляет временные файлы со своего локального диска.

Этот подход позволит отправлять файлы любого размера (до 2 ГБ, что является лимитом Telegram для ботов) и при этом продолжит использовать вашу архитектуру с удаленным сервером для хранения файлов.

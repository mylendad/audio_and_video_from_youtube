# План дальнейших действий по безопасной настройке SSH-ключа

Этот документ описывает шаги для настройки безопасного использования SSH-ключа на удаленном сервере через GitHub Actions, без копирования ключа в Docker-образ.

---

## 1. Ваши действия (создание секретов GitHub)

Вам нужно зайти в настройки вашего репозитория на GitHub и создать **два новых секрета** (в окружении `production`):

1.  **Название секрета:** `STORAGE_SSH_PRIVATE_KEY`
    *   **Значение:** Скопируйте и вставьте сюда **полное содержимое** вашего файла приватного ключа `id_ed25519`. Весь текст, включая строки `-----BEGIN OPENSSH PRIVATE KEY-----` и `-----END OPENSSH PRIVATE KEY-----`. Это гарантирует, что ключ никогда не будет храниться в репозитории или Docker-образе.

2.  **Название секрета:** `STORAGE_KEY_SERVER_PATH`
    *   **Значение:** Укажите **полный путь** на вашем **удаленном сервере**, где будет создан этот файл ключа.
        *   **Важно:** этот путь должен быть **вне папки развертывания проекта (`DEPLOY_PATH`)**, чтобы он не был случайно удален при очистке.
        *   **Пример:** `/home/ваш_юзер_на_сервере/.ssh/storage_id_ed25519` (замените на ваш реальный путь и имя файла).

---

## 2. Мои действия (обновление `cd.yml`)

После того как вы подтвердите, что секреты созданы, я обновлю ваш файл `cd.yml`. Изменения будут включать:

1.  **Новый шаг "Create SSH Key File"**: Этот шаг будет использовать `ssh-action` для:
    *   Создания необходимой директории на сервере, если её нет.
    *   Записи содержимого секрета `STORAGE_SSH_PRIVATE_KEY` в файл по пути, указанному в `STORAGE_KEY_SERVER_PATH`.
    *   Установки правильных разрешений `chmod 600` для файла ключа на сервере.

2.  **Обновление шага "Create .env file on server"**:
    *   Переменная `SSH_KEY_HOST_PATH` в `.env` файле будет получать свое значение из нового секрета `STORAGE_KEY_SERVER_PATH`.

---

## 3. Дальнейшие шаги

После этих изменений вы сможете запустить workflow в GitHub Actions. Он автоматически создаст файл ключа на вашем сервере в указанном месте и затем использует его для монтирования в Docker-контейнер. Это должно решить все проблемы с доступом к ключу и обеспечить безопасное развертывание.